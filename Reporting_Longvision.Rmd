---
title: "Reporting_LongVision"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#Load Libraries
require(xts)
require(quantmod)
require(knitr)
require(dplyr)
#Load Files
source("DataManagement.R")
source("ConvertingData.R")
source("VisualizeData.R")
```

## History Performane "LongVision"
für diese analyse wurde "LongVision" angeschaut. FX Link:

https://www.myfxbook.com/members/autotrade/long-vision/1489427

Datei History Performer wurde folgenderweise bearbeitet:

1. Laden der date
2. alle Doppelten rausnehmen, dh alle einträge die den gleich Open.Date-Zeitstämple haben wurden gelöscht
3. open- und closezeiten in POSIXct gewandelt
4. entfernen von alle einträge ausser "Buy" und "Sell" in spalte "Action"
5. Entfernen von Unique Symbole


```{r PerformerClean1,cache=TRUE,echo=FALSE}
data.Performer.raw<- ImportPerformer("LongVision.csv")
data.Performer.clean<-cleanPerformer(data.Performer.raw)
kable(cbind(data.Performer.raw[1:10,1:5],rep("|",10),data.Performer.clean[1:10,1:5]),align ="c" )
```

Summary:
```{r PerformerClean2,cache=TRUE,echo=FALSE}
summary(data.Performer.clean)

delta<-data.frame(cbind(nrow(data.Performer.raw), nrow(data.Performer.clean)))

names(delta)<-c("einträge vorher","einträge nacher")
kable(delta,align ="c" )
```


Folgende Symbole werden verwendet:
```{r PerformerClean3,cache=TRUE,echo=FALSE}
summary(data.Performer.clean$Symbol)
rm(delta)
rm(data.Performer.raw)
```

Enfernen von Unique Symbole.
Neue Data hat nur folgende Symbolverteilung:

```{r PerformerClean4,cache=TRUE,echo=FALSE}
Sym<-c("AUDUSD", "EURGBP", "EURJPY", "EURUSD", "GBPCHF","GBPUSD", "USDCAD", "USDCHF", "USDJPY")
data.Performer.clean<- removeSymbols(Sym,data.Performer.clean)
summary(data.Performer.clean$Symbol)
```

## History Data:
Historydata geht ab 2012 bis 03/09/2016. Aktuelle runtergeladen

TF  |eurusd |gbpusd |usdjpy |audusd
----|----------------------------------
M1  |       |       |       |
M5  |x      |x      |x      |x
M15 |x      |x      |x      |x
H1  |x      |x      |x      |x
H4  |x      |x      |x      |x
D1  |x      |x      |x      |x



Loading Historical Data as List. First List all TimeFrames of particular Symbol, then list all TimeFrames by Symbol:
```{r Histdata, cache=TRUE}
sym<-"EURUSD"
data.M5<-ImportHistory(sym,"M5")
data.M15<-ImportHistory(sym,"M15")
data.H1<-ImportHistory(sym,"H1")
data.H4<-ImportHistory(sym,"H4")
data.D1<-ImportHistory(sym,"D1")

EURUSD<-list(M5=data.M5,M15=data.M15,H1=data.H1,H4=data.H4, D1=data.D1)

sym<-"GBPUSD"
data.M5<-ImportHistory(sym,"M5")
data.M15<-ImportHistory(sym,"M15")
data.H1<-ImportHistory(sym,"H1")
data.H4<-ImportHistory(sym,"H4")
data.D1<-ImportHistory(sym,"D1")

GBPUSD<-list(M5=data.M5,M15=data.M15,H1=data.H1,H4=data.H4, D1=data.D1)

sym<-"USDJPY"
data.M5<-ImportHistory(sym,"M5")
data.M15<-ImportHistory(sym,"M15")
data.H1<-ImportHistory(sym,"H1")
data.H4<-ImportHistory(sym,"H4")
data.D1<-ImportHistory(sym,"D1")

USDJPY<-list(M5=data.M5,M15=data.M15,H1=data.H1,H4=data.H4, D1=data.D1)

sym<-"AUDUSD"
data.M5<-ImportHistory(sym,"M5")
data.M15<-ImportHistory(sym,"M15")
data.H1<-ImportHistory(sym,"H1")
data.H4<-ImportHistory(sym,"H4")
data.D1<-ImportHistory(sym,"D1")

AUDUSD<-list(M5=data.M5,M15=data.M15,H1=data.H1,H4=data.H4, D1=data.D1)


data.History<-list(EURUSD=EURUSD,GBPUSD=GBPUSD,USDJPY=USDJPY,AUDUSD=AUDUSD)

```

## Historische Daten und Performer Mergen
### 1. Zeitstemp angleichen
Zeit stempel wird an Dukascopy angeglichen (GTM).Laut MyFXbook ist LongVision GTM+2.
Hier werden Random Entries aus der Preformer Data genommen (Nur EURUSD trades) und mit Histroy verglichen.

```{r TimeSync, fig.height=4, fig.width=8, cache=TRUE}
#Pick Random Entry

##Test Parameter:
Symbol<-"EURUSD"

data.Test<- data.History[[Symbol]]
data.Performer.clean.Test<- data.Performer.clean[data.Performer.clean$Symbol==Symbol,]

TF<-"M15"
set.seed(0)
for(n in 1:5)
  {
    TimeSyncVis(data.Test[[TF]],data.Performer.clean,Symbol)
  }
```

Püfen wieviele Entries zwischen High und Low Liegen in abhängigkeit von TimeFrame:

```{r checksync,cache=TRUE, warning=FALSE}

#EURUSD
##M5
checkSync(data.Performer.clean.Test,data.Test[["M5"]])
##M15
checkSync(data.Performer.clean.Test,data.Test[["M15"]])

```

**Nach dieser Analyse Sieht es nicht so aus als müssten man das anpassen. Oben beim Cleaning wurden die Zeiten Convetiert ohne Timezone anzugeben, also wurde da auch nichts geändert. **

### 2. Exploratory Analysis

```{r RandomCharts, fig.height=4,fig.width=8, cache=TRUE}
set.seed(0)
TF<-"M15"
for (n in 1:5)
{      
      RandomePAHistory(data.Test[[TF]],data.Performer.clean, Symbol,200)
}
```


Aktuell kein muster erkennbar bis auf eine Flag-Strategie. In Strategie beschreibung vom Performer ist es eine Summe vo Strategien die auf dem Konto Laufen.


### 3. Performance Data mit Price muster versehen.

In diesem abschnitt wird die daten "data.Performer.Clean" mit eine Preis muster der zur Auswertung später benötigt wird. der Preis musster besteht aus x abgeschlossene Kerzen aus unterschiedliche TFs.

Schreibt File LongVision_AboslutPrice.csv mit xBar Pattern für TFs (M5,M15,H1,H4,D1):

```{r datamerge}
#Folgende Instrumente werden benötigt:
summary(data.Performer.clean$Symbol)

#Bars per TF for Pattern:
Bars.Lookback<-5
SaveFileDirectory<-"./Files/LongVision/"
SaveFileName<-"LongVision_AbsolutPrices.csv"
FilePath<-paste(SaveFileDirectory,SaveFileName,sep="")

#Parameter:
Symbol<-c("EURUSD","GBPUSD","USDJPY","AUDUSD")
Timeframe<-c("M5","M15", "H1","H4","D1")

#get Pattern
data.Performer.pattern.AbsolutPrices<-NULL
data.Performer.pattern<-NULL
for (Sym in Symbol)  
{
  data.Performer.pattern<- subset(data.Performer.clean,Symbol==Sym)

  for(t in Timeframe)
  {
    data.Performer.pattern<-Pattern.KnitWithData(data.Performer.pattern,
                                                 data.History[[Sym]][[t]],
                                                 Bars.Lookback,t,
                                                 timestamp=TRUE,
                                                 netto =  FALSE,
                                                 Normalized =  FALSE,
                                                 rm.open =  FALSE)
  }
  data.Performer.pattern.AbsolutPrices<-rbind(data.Performer.pattern.AbsolutPrices,data.Performer.pattern)
}
  
write.csv(data.Performer.pattern.AbsolutPrices,file=FilePath)

head(data.Performer.pattern,5)
```

Schreibt File LongVision_ScaledPrice.csv mit xBar Pattern für TFs (M5,M15,H1,H4,D1):

```{r scaledPrices}
#Bars per TF for Pattern:
Bars.Lookback<-5
SaveFileDirectory<-"./Files/LongVision/"
SaveFileName<-"LongVision_ScaledPrices.csv"
FilePath<-paste(SaveFileDirectory,SaveFileName,sep="")

#get Pattern
data.Performer.pattern.ScaledPrice<-NULL
data.Performer.pattern<-NULL
for (Sym in Symbol)  
{
  data.Performer.pattern<- subset(data.Performer.clean,Symbol==Sym)
  data.Performer.pattern<- data.Performer.pattern[1:10,]
  for(t in Timeframe)
  {
    data.Performer.pattern<-Pattern.KnitWithData(data.Performer.pattern,
                                                 data.History[[Sym]][[t]],
                                                 Bars.Lookback,t,
                                                 timestamp=FALSE,
                                                 netto =  TRUE,
                                                 Normalized =  TRUE,
                                                 rm.open =  TRUE)
  }
  data.Performer.pattern.ScaledPrice<-rbind(data.Performer.pattern.ScaledPrice,data.Performer.pattern)
}
  
write.csv(data.Performer.pattern.ScaledPrice,file=FilePath)

head(data.Performer.pattern,5)
```


## 4. Create Test Data  



```{r EntrieData}
SaveFileDirectory<-"./Files/LongVision/"
SaveFileName<-"LongVision_PatternEntries.csv"
FilePath<-paste(SaveFileDirectory,SaveFileName,sep="")


data.Pattern.Entries<-Pattern.Entries(data.Performer.pattern.ScaledPrice,Timeframe, Bars.Lookback)

f<-c("open","Action")
start<-ncol(data.Performer.clean)+1
end<-ncol(data.Pattern.Entries)
Hour<-format(data.Pattern.Entries[,"open"],"%H")
Min<-format(data.Pattern.Entries[,"open"],"%M")
data.Pattern.Entries<-cbind(data.Pattern.Entries[,f],Hour,Min, data.Pattern.Entries[,start:end])

write.csv(data.Pattern.Entries,file=FilePath)
head(data.Pattern.Entries,5)
```







